#include"팀플.h"

void line_up(struct rank r[12]);

// 깃발

char blank[50] = "    ";
char iiiitem[50] = "아이템을 사용하시려면 i를 눌러주세요";

int main(void) {
	int M[30][30] = { { '■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■' },  //1
	                  { '■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■' },  //2
	                  { '■','  ','■','■','■','■','■','■','■','■','■','■','■','  ','■','  ','■','■','■','■','■','■','■','■','■','■','  ','■','  ','■' },  //3
	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' },  //4
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','■','  ','■','  ','■','  ','■','■','■','■','■','■','■','■','  ','■','  ','■' },  //5
	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' },  //6
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','■','  ','■','  ','■','  ','■','■','■','■','■','■','■','■','  ','■','  ','■' }, //7
   	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■' }, //8
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','■','■','  ','■','■','■','■','■','■','■','■','■','■','■','■','■','  ','■' }, //9
	                  { '■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','■','  ','■' }, //10	
	                  { '■','■','  ','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','■','  ','  ','■','  ','■' }, //11
	                  { '■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','  ','  ','  ','■' }, //12
	                  { '■','  ','■','■','■','  ','■','■','■','■','■','  ','■','  ','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','  ','■' }, //13
	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' }, //14
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','■','■','  ','■','■','■','■','■','■','■','■','■','■','■','  ','■','  ','■' }, //15
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','■','■','  ','■','■','■','■','■','■','■','■','■','■','■','  ','■','  ','■' }, //16   
	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' }, //17
	                  { '■','  ','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','  ','■' }, //18
	                  { '■','  ','  ','  ','■','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■' }, //19
	                  { '■','  ','■','  ','  ','■','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','■','  ','■','■','■','■','  ','■','■' }, //20
	                  { '■','  ','■','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■' }, //21
	                  { '■','  ','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','  ','■','  ','■' }, //22
	                  { '■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' }, //23
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','  ','■','  ','■','  ','■','■','■','■','■','■','■','■','■','  ','■','  ','■' }, //24
	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' }, //25
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','  ','■','  ','■','  ','■','■','■','■','■','■','■','■','■','  ','■','  ','■' }, //26
	                  { '■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','■' }, //27
	                  { '■','  ','■','  ','■','■','■','■','■','■','■','■','■','■','  ','■','  ','■','■','■','■','■','■','■','■','■','■','■','  ','■' }, //28
	                  { '■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','  ','■' }, //29
	                  { '■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■','■' }  //30
	};
	char input_text[60] = { ' ' };
	char prase1[60] = { ' ' };
	char prase2[60] = { ' ' };
	char prase3[60] = { ' ' };
	 
	
	struct rank r[12];
	int i = 0,j;
	int jump_num = 5;
	int freeze_num = 4;
	//int time = time((unsigned)NULL);
	int point = 0;
	int level= 1;
	int monster_x[10], monster_y[10];
	int player_x, player_y;
	int R_sub, R_player, R_monster, R_flag;
	int num_T;
	int monster_stop=1;

	system("mode con: cols=120 lines=50");
	srand((unsigned)time(NULL));
	for (i = 0; i < 12; i++)
	{
		for(j = 0; j < 3; j++)
			r[i].name[j] = ' ';
		r[i].point = 100000;
	}

	while (1) {
		
		for (i = 0; i < 30; i++) {
			for (j = 0; j < 30; j++) {

				if (M[i][j] != '■')
					M[i][j] = 8224;

			 }
		}
		jump_num = 5;
		freeze_num = 4;
		point = 0;
		
		
		player_x = 20; // 게임 시작할때 player 초기화 되어야되서 여기에
		player_y = 16;
		for(i=0;i<2;i++){
		strcpy(input_text, blank);
		text_print(input_text, prase1, prase2, prase3);
		}
		R_sub = sub_main(&level, r);
		num_T = 2*level;
		if (R_sub) {

			map(M, &player_x, &player_y, level, monster_x, monster_y);

			strcpy(input_text, iiiitem);
			text_print(input_text, prase1, prase2, prase3);
			status_print(jump_num, freeze_num,num_T,point);
			
			gotoxy(2 * (player_x), player_y);
			printf("◆");

			while (1) {
				R_player = player(M, &player_x, &player_y,&monster_stop,input_text,prase1,prase2,prase3,&jump_num, &freeze_num, &point);
				R_flag = flag(M, &player_x, &player_y, &num_T, input_text, prase1, prase2, prase3, &point);
				if (R_flag==2) {
					system("cls");
					gotoxy(15, 15);
					printf("승리!\n");
					printf("               당신의 점수는 %3d 입니다.",point);
					Sleep(1000);
					printf("\n             이름 세글자를 연이어 입력해주세요 : \n               ");
					gets(r[10].name);
					r[10].point = point;
					line_up(r);
					break;
				}

				status_print(jump_num, freeze_num,num_T,point);
				switch (R_flag) {
				case 0:
					
					while(monster_stop>0){
						monster_stop--;
						R_monster = monster(M, &player_x, &player_y, level, monster_x, monster_y);
					}
					monster_stop++;
					break;
				case 1:
					break;
				}
				
				if (R_monster==1) {
					die();
					break;
				}
			}

		}
		else
			return 0;
	}
}
void line_up(struct rank r[12])
{
	int i;
	for (i = 10; i > 0; i--) {
		if (r[i - 1].point > r[i].point)
		{
			r[11] = r[i - 1];
			r[i - 1] = r[i];
			r[i] = r[11];
		}
	}
}